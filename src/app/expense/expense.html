<div class="expense-wrapper">
  <h2>Expense Management</h2>

  <!-- Add Expense Form -->
 <div class="expense-form card">

  <!-- Dynamic heading based on mode -->
  <h3>{{ editMode ? 'Update Expense' : 'Add New Expense' }}</h3>

  <!-- Form submit now points to submitExpense() which handles both add and update -->
  <form (ngSubmit)="submitExpense()" enctype="multipart/form-data">
    
    <!-- Employee ID and Expense Type ID inputs -->
    <div class="form-group">
      <input
        type="number"
        placeholder="Employee Id"
        [(ngModel)]="newExpense.employeeId"
        name="employeeId"
        required
      >
      <input
        type="number"
        placeholder="Expense Type Id"
        [(ngModel)]="newExpense.expensetypeId"
        name="expensetypeId"
        required
      >
    </div>

    <!-- Amount and Receipt File Upload -->
    <div class="form-group">
      <input
        type="number"
        placeholder="Amount"
        [(ngModel)]="newExpense.amount"
        name="amount"
        required
      >
      <input
        type="file"
        (change)="onFileChange($event)"
      >
    </div>

    <!-- Description textarea -->
    <textarea
      placeholder="Description"
      [(ngModel)]="newExpense.description"
      name="description"
      required
    ></textarea>

    <!-- Submit button changes text based on editMode -->
    <button type="submit" class="btn-primary">
      {{ editMode ? 'Update Expense' : 'Add Expense' }}
    </button>

    <!-- Cancel button shown only in edit mode to reset form -->
    <button
      type="button"
      *ngIf="editMode"
      class="btn-secondary"
      (click)="resetForm()"
    >
      Cancel
    </button>
  </form>
</div>

  <hr>

  <!-- Expenses Table -->
  <div class="expense-table card">
    <h3>All Expenses</h3>
    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Employee</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Description</th>
            <th>Receipt</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let expense of expenses">
            <td>{{expense.expenseId}}</td>
            <td>{{expense.employeeId}}</td>
            <td>{{expense.expensetypeId}}</td>
            <td>{{expense.amount | currency}}</td>
            <td>{{expense.description}}</td>
            <td>
              <a *ngIf="expense.receiptUrl" [href]="expense.receiptUrl" target="_blank" class="btn-view">View</a>
            </td>
            <td>
              <span class="status" [ngClass]="expense.status.toLowerCase()">{{expense.status}}</span>
            </td>
            <td>
              <button class="btn-delete" (click)="deleteExpense(expense.expenseId)">Delete</button>&nbsp;
              <button class="btn-update" (click)="editExpense(expense)">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
